<Controls:MetroWindow
    Closed="MetroWindow_Closed"
    Closing="MetroWindow_Closing"
    DataContext="{Binding Main, Source={StaticResource Locator}}"
    Dialog:DialogParticipation.Register="{Binding}"
    Height="350"
    Icon="GFX/Focus/goal_unknown.png"
    Loaded="MetroWindow_Loaded"
    Title="{DynamicResource Main_Title}"
    Width="525"
    WindowState="Maximized"
    mc:Ignorable="d"
    x:Class="FocusTreeManager.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
    xmlns:Dialog="clr-namespace:MahApps.Metro.Controls.Dialogs;assembly=MahApps.Metro"
    xmlns:cmd="clr-namespace:GalaSoft.MvvmLight.Command;assembly=GalaSoft.MvvmLight.Platform"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dockablz="clr-namespace:Dragablz.Dockablz;assembly=Dragablz"
    xmlns:dragablz="clr-namespace:Dragablz;assembly=Dragablz"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:tabModels="clr-namespace:FocusTreeManager.Model.TabModels"
    xmlns:vu="clr-namespace:FocusTreeManager.Views.UserControls"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <cmd:EventToCommand Command="{Binding WindowLoadedCommand}" PassEventArgsToCommand="True" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Icons.xaml" />
                <ResourceDictionary Source="/FocusTreeManager;component/Languages/zh_CN.xaml" x:Name="LocalizationStrings" />
                <ResourceDictionary Source="pack://application:,,,/Dragablz;component/Themes/MahApps.xaml" />
                <ResourceDictionary>
                    <TextBlock Cursor="Resources/Cursors/grabbing.cur" x:Key="CursorGrabbing" />
                </ResourceDictionary>
            </ResourceDictionary.MergedDictionaries>
            <DataTemplate DataType="{x:Type tabModels:FocusGridModel}">
                <Grid>
                    <ScrollViewer
                        Background="Transparent"
                        HorizontalScrollBarVisibility="Auto"
                        PreviewMouseDown="scrollViewer_PreviewMouseLeftButtonDown"
                        PreviewMouseMove="ContentScroll_PreviewMouseMove"
                        PreviewMouseUp="scrollViewer_PreviewMouseLeftButtonUp"
                        ScrollChanged="ScrollViewer_ScrollChanged"
                        VerticalScrollBarVisibility="Auto"
                        x:Name="FocusGridScroll">
                        <vu:FocusGrid x:Name="FociGrid" />
                    </ScrollViewer>
                    <!--  <vu:TutorialButton  -->
                    <!--  Margin="0,0,15,0"  -->
                    <!--  HorizontalAlignment="Right"  -->
                    <!--  VerticalAlignment="Top"  -->
                    <!--  LinkedElement="{Binding ElementName=FociGrid}" />  -->
                </Grid>
            </DataTemplate>
            <DataTemplate DataType="{x:Type tabModels:LocalisationModel}">
                <Grid>
                    <vu:Localisation x:Name="LocalizationList" />
                </Grid>
            </DataTemplate>
            <DataTemplate DataType="{x:Type tabModels:EventTabModel}">
                <Grid>
                    <vu:EventList x:Name="EventList" />
                </Grid>
            </DataTemplate>
            <DataTemplate DataType="{x:Type tabModels:ScriptModel}">
                <Grid DataContext="{Binding}" x:Name="ScriptEditor">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="50" />
                    </Grid.RowDefinitions>
                    <Grid.InputBindings>
                        <KeyBinding
                            Command="{Binding SaveScriptCommand}"
                            CommandParameter="{Binding ElementName=Scripter}"
                            Key="S"
                            Modifiers="Control" />
                    </Grid.InputBindings>
                    <vu:Scripter Grid.Row="0" x:Name="Scripter" />
                    <StackPanel Grid.Row="1" HorizontalAlignment="Right">
                        <Button
                            Command="{Binding SaveScriptCommand}"
                            CommandParameter="{Binding ElementName=Scripter}"
                            Content="{DynamicResource Command_Save}"
                            Style="{DynamicResource SquareButtonStyle}"
                            Width="150" />
                    </StackPanel>
                </Grid>
            </DataTemplate>
        </ResourceDictionary>
    </Window.Resources>
    <Window.InputBindings>
        <KeyBinding
            Command="{Binding SaveProjectCommand}"
            Key="S"
            Modifiers="Control" />
        <KeyBinding
            Command="{Binding LoadProjectCommand}"
            Key="L"
            Modifiers="Control" />
        <KeyBinding
            Command="{Binding ExportProjectCommand}"
            Key="E"
            Modifiers="Control" />
        <KeyBinding
            Command="{Binding NewProjectCommand}"
            Key="N"
            Modifiers="Control" />
        <KeyBinding
            Command="{Binding UndoCommand}"
            Key="Z"
            Modifiers="Control" />
        <KeyBinding
            Command="{Binding RedoCommand}"
            Key="Y"
            Modifiers="Control" />
    </Window.InputBindings>
    <Controls:MetroWindow.RightWindowCommands>
        <Controls:WindowCommands>
            <Button Command="{Binding UndoCommand}" x:Name="UndoButton">
                <StackPanel Orientation="Horizontal">
                    <Rectangle
                        Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"
                        Height="20"
                        Width="20">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_undo_curve}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </StackPanel>
            </Button>
            <Button Command="{Binding RedoCommand}">
                <StackPanel Orientation="Horizontal">
                    <Rectangle
                        Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"
                        Height="20"
                        Width="20">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_redo_curve}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </StackPanel>
            </Button>
            <Button Command="{Binding ExportProjectCommand}" x:Name="ExportButton">
                <StackPanel Orientation="Horizontal">
                    <Rectangle
                        Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"
                        Height="20"
                        Width="20">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_page_xml}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                    <TextBlock
                        Margin="4,0,0,0"
                        Text="{StaticResource Menu_Export}"
                        VerticalAlignment="Center" />
                </StackPanel>
            </Button>
            <Button Click="ProjectButton_Click" x:Name="ProjectButton">
                <StackPanel Orientation="Horizontal">
                    <Rectangle
                        Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"
                        Height="20"
                        Width="20">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_page}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                    <TextBlock
                        Margin="4,0,0,0"
                        Text="{DynamicResource Menu_Project}"
                        VerticalAlignment="Center" />
                </StackPanel>
            </Button>
            <Button Click="SettingsButton_Click">
                <StackPanel Orientation="Horizontal">
                    <Rectangle
                        Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"
                        Height="20"
                        Width="20">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_settings}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                    <TextBlock
                        Margin="4,0,0,0"
                        Text="{DynamicResource Menu_Settings}"
                        VerticalAlignment="Center" />
                </StackPanel>
            </Button>
        </Controls:WindowCommands>
    </Controls:MetroWindow.RightWindowCommands>
    <Controls:MetroWindow.Flyouts>
        <Controls:FlyoutsControl>
            <Controls:Flyout
                IsModal="True"
                Position="Right"
                Width="400"
                x:Name="FocusFlyout">
                <vu:FocusEditor />
            </Controls:Flyout>
            <Controls:Flyout
                CloseButtonVisibility="Hidden"
                IsModal="True"
                IsOpen="True"
                Position="Left"
                VerticalAlignment="Center"
                Width="400"
                x:Name="ProjectFlyout">
                <StackPanel CanVerticallyScroll="True" Orientation="Vertical">
                    <Button
                        Command="{Binding NewProjectCommand}"
                        Content="{DynamicResource appbar_page_new}"
                        Height="100"
                        Style="{DynamicResource MetroCircleButtonStyle}"
                        Width="100"
                        x:Name="NewButton" />
                    <Label
                        Content="{DynamicResource Project_New}"
                        FontSize="20"
                        HorizontalAlignment="Center" />
                    <Button
                        Command="{Binding LoadProjectCommand}"
                        Content="{DynamicResource appbar_page_upload}"
                        Height="100"
                        Style="{DynamicResource MetroCircleButtonStyle}"
                        Width="100"
                        x:Name="LoadButton" />
                    <Label
                        Content="{DynamicResource Project_Load}"
                        FontSize="20"
                        HorizontalAlignment="Center" />
                    <Button
                        Command="{Binding EditProjectCommand}"
                        Content="{DynamicResource appbar_page_edit}"
                        Height="100"
                        IsEnabled="{Binding IsProjectExist}"
                        Style="{DynamicResource MetroCircleButtonStyle}"
                        Width="100"
                        x:Name="EditButton" />
                    <Label
                        Content="{DynamicResource Project_Edit}"
                        FontSize="20"
                        HorizontalAlignment="Center" />
                    <Button
                        Command="{Binding SaveProjectCommand}"
                        Content="{DynamicResource appbar_page_download}"
                        Height="100"
                        IsEnabled="{Binding IsProjectExist}"
                        Style="{DynamicResource MetroCircleButtonStyle}"
                        Width="100"
                        x:Name="SaveButton" />
                    <Label
                        Content="{DynamicResource Project_Save}"
                        FontSize="20"
                        HorizontalAlignment="Center" />
                    <Button
                        Command="{Binding SaveProjectAsCommand}"
                        Content="{DynamicResource appbar_page_duplicate}"
                        Height="100"
                        IsEnabled="{Binding IsProjectExist}"
                        Style="{DynamicResource MetroCircleButtonStyle}"
                        Width="100"
                        x:Name="SaveAsButton" />
                    <Label
                        Content="{DynamicResource Project_Save_As}"
                        FontSize="20"
                        HorizontalAlignment="Center" />
                </StackPanel>
            </Controls:Flyout>
        </Controls:FlyoutsControl>
    </Controls:MetroWindow.Flyouts>
    <Grid>
        <Grid x:Name="MainGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <vu:ProjectView Grid.Column="0" x:Name="FileViewer" />
            <GridSplitter
                Grid.Column="1"
                HorizontalAlignment="Stretch"
                Width="5" />
            <DockPanel Grid.Column="2">
                <Grid DockPanel.Dock="Bottom" Panel.ZIndex="1">
                    <StatusBar DataContext="{Binding StatusBar, Source={StaticResource Locator}}">
                        <StatusBarItem>
                            <TextBlock Name="StatusText" Text="{Binding Message}" />
                        </StatusBarItem>
                    </StatusBar>
                    <Grid
                        Height="110"
                        HorizontalAlignment="Right"
                        Margin="0,-130,15,0"
                        Width="70"
                        x:Name="GridErrors">
                        <vu:ErrorDawg />
                    </Grid>
                </Grid>
                <dockablz:Layout
                    FloatingItemContainerStyle="{DynamicResource MahAppsToolDragablzItemStyle}"
                    FloatingItemDisplayMemberPath="Content"
                    FloatingItemHeaderMemberPath="Header">
                    <dragablz:TabablzControl
                        ItemsSource="{Binding TabsModelList}"
                        SelectedItem="{Binding SelectedTab}"
                        SelectionChanged="CentralTabControl_SelectionChanged"
                        ShowDefaultAddButton="False"
                        ShowDefaultCloseButton="True"
                        x:Name="CentralTabControl">
                        <dragablz:TabablzControl.HeaderItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding VisibleName}" />
                            </DataTemplate>
                        </dragablz:TabablzControl.HeaderItemTemplate>
                        <TabControl.ItemTemplate>
                            <DataTemplate>
                                <DockPanel />
                            </DataTemplate>
                        </TabControl.ItemTemplate>
                    </dragablz:TabablzControl>
                </dockablz:Layout>
            </DockPanel>
        </Grid>
    </Grid>
</Controls:MetroWindow>
